# ИДЗ №1 Вариант 23
## Амирханов Никита Русланович БПИ219

### Условия
Разработать программу, которая ищет в ASCII-строке заданную
подстроку и возвращает индекс первого символа первого вхож-
дения подстроки в строке. Подстрока вводится как параметр.

### Задание решено на 10 баллов.
 - Есть исходный код на си, скомпилированный с разными опциями, шаги рефакторинга ассемблероного кода пропущены т.к. писалась программа на ассемблере с нуля.
 - Есть сравнительные тесты показывающие скорость работы обоих программ.
 - Есть генератор случайных чисел с указанием границ
 - Есть ввод-вывод из файла
 - Есть измерение времени работы программы
 - Есть текст программы на языке ассемблера без использования си функций
 - Весь ассемблерный код содержит поясняющие комментарии

### Структура папок
 - `/asm` содержит исходный код на ассембеле без использования си функций
 - `/asm/lib` содержит файлы с дополнительными функциями
 - - `array.s` - работа с массивами
 - - `io.s` - ввод/вывод из консоли/файлов
 - - `str.s` - работа со строками
 - - `time.s` - замер времени
 - - `rand.s` - генерация случайных чисел
 - `/asm/main.s` - главный файл программы
 - `/c-stuff` содержит исходный код на языке си и результаты его компиляции
 - `/tests` папка с тестами
 - Файл `make-tests.py` позволяет создавать тесты необходимой длины

### Запуск ассемблерного кода
```sh
make compile    ; компилирует все дополнительные библиотеки
make build      ; компилирует основой код с добавлением библиотек
```
Далее, чтобы выполнить просто `./main`. Для работы с консолью необходимо указать флаг `-c`. Для ввода и вывода в файл необходимо укзазать флаг `-f` и два аргумента `./main -f <input_file_string> <input_file_substring> <output_file>`. Для работы с генератором случайных чисел необходимо набрать `./main -r <string_len> <substring_len>`. В таком случае на экран будет выведена сгенерированная строка и подстрока. Ограничение на ввод строки через консоль и при генерации 4096 символов. Для ввода из файла это ограничение 100000000 символов. При вводе большего числа будет выведено сообщение. Ограничения на вводмимые символы нет, внутри строит проверка на диапазон 0-127.

### Запуск си кода
```sh
gcc main.c -o main
```
В си программе отсутствует ручной ввод вывод. В остальном используются те же аргументы и их ограничения.

### Важно
 - В папке `tests` нет тестов на 100000000 символов из за большого размера файла.
 - Пример файла ввод string
```
some text
new line

```
 - Пример файла ввод substring
```
new
```

### Работа с рандомайзером
В обоих случая надо при запуске указать параметры. Пример:
```sh
$ ./main -r 20 10
Generated string: <Th|$8L^r.BVh~(<
Generated substring: T
Position of substring: 1
```
Выведется сгеренированная строка длиной 20 и подстока длиной 10. Резултат выполнения будет выведен в консоль.

### Тестирование ASM
 - Тест где будет найдена подстрока `./main ../tests/t1str.txt ../tests/t1sub.txt out.txt`
 ```
 hello from
 the other side!
 ```
 ```
 the
 ```
 Результат
 ```
XXX

```
 - Тест где не будет найдена подстрока `./main ../tests/t2str.txt ../tests/t2sub.txt out.txt`
 ```
aaaaaa
 ```
 ```
bbb
 ```
 Результат
 ```
-1

```
 - Тест где будет показано что выводится первое вхождение `./main ../tests/t3str.txt ../tests/t3sub.txt out.txt`
 ```
hello from the hell!
 ```
 ```
 hell
 ```
 Результат
 ```
0

```

### Тестирование C
 - Тест где будет найдена подстрока `./main ../tests/t1str.txt ../tests/t1sub.txt out.txt`
 ```
 hello from
 the other side!
 ```
 ```
 the
 ```
 Результат
 ```
XXX

```
 - Тест где не будет найдена подстрока `./main ../tests/t2str.txt ../tests/t2sub.txt out.txt`
 ```
aaaaaa
 ```
 ```
bbb
 ```
 Результат
 ```
-1

```
 - Тест где будет показано что выводится первое вхождение `./main ../tests/t3str.txt ../tests/t3sub.txt out.txt`
 ```
hello from the hell!
 ```
 ```
 hell
 ```
 Результат
 ```
0

```

### Вывод тестирования
Результаты работы программ совпадают

### Сравнение прогамм на си и asm
1. Размер исполняемого файла
 - Размер ассемблероного файла сгенерированного из си кода при помощи флагов `-masm=intel -fno-asynchronous-unwind-tables -fno-jump-tables -fno-stack-protector -fno-exceptions -Os` составляет всего 243 строки. А с оптимизацией `-Ofast` 377 строк. В то же время размер самописной программы на ассемблере составляет 413 строк в main файле + 530 строк в вспомогательных файлах. Однако размер исполняемого файла на ассемблере составляет 8,7K а у программы на си 13K, а с флагом `-Os` тоже 13K.
2. Время работы программ 
 - Тестировалась работа программ написанных на ассемблере, на си, на ассемблероном коде, скомпилированным при помощи флага `-Ofast`, а так же при помощи флага `-Os`.
 - На тесте в 100000 элементов:
 ```
asm                         c:          -Ofast asm  -Os asm  
--------------------------------------------------------------
Read:          0.78601389   | 0.004616  | 0.004694  | 0.004389
Calculations:  0.263031     | 0.000126  | 0.000140  | 0.000115
Write:         0.287058676  | 0.004586  | 0.004624  | 0.003961
 ```
  - На тесте в 1000000 элементов:
 ```
asm:                        c:          -Ofast asm  -Os asm
 -------------------------------------------------------------
Read:          0.727040354  | 0.044912  | 0.046473  | 0.045780
Calculations:  0.2503454    | 0.001279  | 0.001220  | 0.001285
Write:         2.433563873  | 0.044850  | 0.044344  | 0.041114
 ```
  - На тесте в 10000000 элементов:
 ```
asm:                        c:          -Ofast asm  -Os asm
--------------------------------------------------------------
Read:          7.362924217  | 0.508615  | 0.447636  | 0.439966
Calculations:  0.22556240   | 0.053719  | 0.010598  | 0.012137
Write:         25.433004001 | 0.516155  | 0.452513  | 0.442933
 ```
  - На тесте в 100000000 элементов:
 ```
asm:                        c:          -Ofast asm  -Os asm
 -------------------------------------------------------------
Read:          72.466802783 | 5.043507  | 4.470650  | 4.498052
Calculations:  0.957936372  | 0.553682  | 0.136249  | 0.115879
Write:         256.506313724| 5.078061  | 4.506198  | 4.125936
 ```
 3. Обработка некорректных данных
  - Количество элементов больше 100000000
  - - Обе программы выводят сообщение об ошибке.
  - Указанного файла не существует
  - - Программы нвыводят сообщение об ошибке.



### Вывод
Компилятор gcc осказался умнее меня. Скорость работы программы на чистом ассемблере оказалась меньше чем на си с разницей до 4-х раз. При этом время на операции ввода и вывода оказалось в среднем в 50 раз больше. Размер исполняемого файла на ассемблере оказлся меньше чем на си. При этом, написание когда на ассемблее во много раз дольше.